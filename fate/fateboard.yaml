apiVersion: apps.openshift.io/v1
kind: DeploymentConfig
metadata:
  labels:
    app: fateboard-40001
  name: fateboard-40001
spec:
  replicas: 1
  selector:
    app: fateboard-40001
    deploymentconfig: fateboard-40001
  template:
    metadata:
      labels:
        app: fateboard-40001
        deploymentconfig: fateboard-40001
    spec:
      containers:
      - args:
        - sed -i "s#^spring.datasource.url=.*#spring.datasource.url=jdbc:mysql://${MYSQL_IP}:3306/${MYSQL_DATABASE}?characterEncoding=utf8\&characterSetResults=utf8\&autoReconnect=true\&failOverReadOnly=false\&serverTimezone=GMT%2B8#g"
          /data/projects/fate/fateboard/conf/application.properties &&sed -i "s#^fate.url=.*#fate.url=http://${MY_POD_IP}:9380#g"
          /data/projects/fate/fateboard/conf/application.properties && echo ${MY_POD_IP}
          >> aaa && echo ${PARTY_ID} >> aaa && java -Dspring.config.location=$configpath/application.properties
          -Dssh_config_file=$configpath -Xmx2048m -Xms2048m -XX:+PrintGCDetails -XX:+PrintGCDateStamps
          -Xloggc:gc.log -XX:+HeapDumpOnOutOfMemoryError  -jar $basepath/fateboard.jar
          >/dev/null 2>&1
        command:
        - /bin/sh
        - -c
        env:
        - name: MY_POD_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: PARTY_ID
          value: "40001"
        - name: MYSQL_IP
          value: mysql-40001
        - name: MYSQL_DATABASE
          value: fateflowdb
        image: docker-repo.sonic.com:443/fate/fateboard-40001@sha256:f3f09b5a94f7d1e6fa80269c73317ee686bd6ed303060c017cfda0f05729f1a3
        imagePullPolicy: IfNotPresent
        name: fateboard-40001
        ports:
        - containerPort: 8080
          protocol: TCP
